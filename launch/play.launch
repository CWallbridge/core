<launch>

    <arg name="with_attention"      default="false" />
    <arg name="with_robot"          default="false" />
    <arg name="with_marker_localisation"          default="false" />
    <arg name="nao_ip"              default="$(optenv NAO_IP 127.0.0.1)" />
    <arg name="nao_port"            default="$(optenv NAO_PORT 9559)" />

    <arg name="roscore_ip"          default="127.0.0.1" />
    <arg name="network_interface"   default="eth0" />

    <arg name="camera_frame"        default="/camera" />

    <group if="$(arg with_robot)">
        <!-- naoqi driver -->
        <include file="$(find naoqi_driver)/launch/naoqi_driver.launch" >
            <arg name="nao_ip"            value="$(arg nao_ip)" />
            <arg name="nao_port"          value="$(arg nao_port)" />
            <arg name="roscore_ip"        value="$(arg roscore_ip)" />
            <arg name="network_interface" value="$(arg network_interface)" />
        </include>

        <node pkg="playground_builder" type="nao_playground_behaviours" name="nao_behaviours">
            <param name="nao_ip"            value="$(arg nao_ip)" />
        </node>
    </group>

    <!-- Sets the image source. -->
    <arg name="image" if="$(arg with_robot)" default="/naoqi_driver_node/camera/front/image_raw" />
    <!-- Sets the image source. -->
    <arg name="image" unless="$(arg with_robot)" default="/v4l/camera/image_raw" />

    <group if="$(arg with_attention)">

        <group unless="$(arg with_robot)">
            <arg name="camera_device" default="/dev/video0" /> <!-- only used if using external camera -->
            <!-- Start the GSCAM camera driver -->
            <node ns="v4l" name="gscam_driver_v4l" pkg="gscam" type="gscam" output="screen">
                <param name="camera_name" value="default"/>
                <param name="camera_info_url" value="package://gscam/logitech-webcam-pro-9000.ini"/>
                <param name="gscam_config" value="v4l2src device=$(arg camera_device) ! video/x-raw-rgb,framerate=30/1 ! ffmpegcolorspace"/>
                <param name="frame_id" value="$(arg camera_frame)"/>
                <param name="sync_sink" value="true"/>
            </node>
            <!-- publish a transform for the camera, assuming a webcam above the sandtray's screen -->
            <node name="gscam_transform" pkg="tf" type="static_transform_publisher" args="0.30 0.02 0.03 3.141 0 0 /sandtray $(arg camera_frame) 100"/>
        </group>
        <node pkg="gazr" type="estimate" name="gazr">
            <param name="face_model" value="$(find gazr)/shape_predictor_68_face_landmarks.dat" />
            <remap from="/image" to="$(arg image)"/>
        </node>

        <node name="sandtray_gaze_viz" pkg="playground_builder" type="sandtray_gaze_viz" />
        <node name="estimate_focus" pkg="playground_builder" type="estimate_focus" />
    </group>

    <group if="$(arg with_marker_localisation)">
        <node pkg="playground_builder" type="sandtray_localisation" name="sandtray_localisation">
            <remap from="/image" to="$(arg image)" />
        </node>
    </group>


    <node pkg="playground_builder" type="playground_map_and_plan" name="map_and_plan">
    </node>
    <node pkg="playground_builder" type="move_playground_items" name="move_playground_items">
    </node>
    <node pkg="playground_builder" type="play" name="playground_play" output="screen">
    </node>

</launch>
